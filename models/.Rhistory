labs(title = "PAR", x = "FT height", y = "Absorbed PAR", colour = "Flat top")
final_results_ft
PAR_calculator_ft <- function(data,indi_la = 47.62) {
met <- readmet(filename = "met.dat", nlines = -1)
la = indi_la
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(absPAR_ft = (sum(MJ*delta_t)*la))
}
PAR_calculator_ppa <- function(data,indi_la = 47.62) {
met <- readmet(filename = "met.dat", nlines = -1)
la = indi_la
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai_ppa)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(absPAR_ppa = (sum(MJ*delta_t)*la))
}
PAR_calculator_ppa <- function(data,indi_la = 47.62) {
met <- readmet(filename = "met.dat", nlines = -1)
la = indi_la
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai_ppa)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(absPAR_ppa = (sum(MJ*delta_t)*la))
}
PAR_calculator_ft <- function(data,indi_la = 47.62) {
met <- readmet(filename = "met.dat", nlines = -1)
la = indi_la
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(absPAR = (sum(MJ*delta_t)*la))
}
PAR_calculator_ppa <- function(data,indi_la = 47.62) {
met <- readmet(filename = "met.dat", nlines = -1)
la = indi_la
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai_ppa)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(absPAR = (sum(MJ*delta_t)*la))
}
PAR_calculator_ft <- function(data,indi_la = 47.62) {
met <- readmet(filename = "met.dat", nlines = -1)
la = indi_la
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(absPAR = (sum(MJ*delta_t)*la))
}
PAR_calculator_ppa <- function(data,indi_la = 47.62) {
met <- readmet(filename = "met.dat", nlines = -1)
la = indi_la
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai_ppa)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(absPAR = (sum(MJ*delta_t)*la))
}
results_PAR_ft <- results_f %>%
purrr::map(PAR_calculator_ft)
results_PAR_ppa <- results_f %>%
purrr::map(PAR_calculator_ppa)
combining_results_ft <- function(sim_name) {
df <- combinations %>%
filter(name == sim_name) %>%
bind_cols(results_PAR_ft[[sim_name]])
}
combining_results_ppa <- function(sim_name) {
df <- combinations %>%
filter(name == sim_name) %>%
bind_cols(results_PAR_ppa[[sim_name]])
}
combined_results_ft <- combinations$name[1:nrow(combinations)] %>%
purrr::map(combining_results_ft)
names(combined_results_ft) <- combinations$name[1:nrow(combinations)] %>%
basename()
combined_results_ppa <- combinations$name[1:nrow(combinations)] %>%
purrr::map(combining_results_ppa)
names(combined_results_ppa) <- combinations$name[1:nrow(combinations)] %>%
basename()
organising_results <- function(data) {
df <- as.data.frame(matrix(unlist(data), nrow=length(unlist(data[1]))))
row.names(df) <- c("H", "V", "L", "F", "S", "path", "name", "absPAR")
df <- t(df)
row.names(df) <- 1:nrow(combinations)
df <- df %>% as_tibble() %>%
select(H, V, L, F, S, path, absPAR) %>%
mutate(
name = path %>% basename() %>% gsub("_S[1-3]", "",., perl = TRUE)
)
df <-  df %>%
transform(absPAR = as.numeric(absPAR), F = as.numeric(F),
H = as.numeric(H), V = as.numeric(V),
L = as.numeric(L), S = as.numeric(S))
df <- df %>%
group_by(H, V, L, F, name) %>%
summarise_at(vars(absPAR), mean)
}
final_results_ft <- organising_results(combined_results_ft)
final_results_ppa <- organising_results(combined_results_ppa)
final_results_ft %>%
select(F, absPAR, H, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(H))) +
geom_line(aes(colour = as.factor(H))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(title = "PAR", x = "FT height", y = "Absorbed PAR", colour = "Flat top")
final_results_ppa %>%
select(F, absPAR, H, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(H))) +
geom_line(aes(colour = as.factor(H))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(title = "PAR", x = "FT height", y = "Absorbed PAR", colour = "Flat top")
ggplot(final_results_ft, aes(F, absPAR)) +
geom_point(final_results_ft, aes(colour = as.factor(H))) +
geom_line(final_results_ft, aes(colour = as.factor(H))) +
geom_point(final_results_ppa, aes(colour = as.factor(H))) +
geom_line(final_results_ppa, aes(colour = as.factor(H))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(title = "PAR", x = "FT height", y = "Absorbed PAR")
final_results_ft
final_results_ft %>% rename(absPAR_ft = absPAR)
final_results_ft %>% add_column(model = rep(1, 280))
final_results_ft %>% add_column(model = rep(1, 380))
final_results_ppa %>% add_column(model = rep(0, 380))
final_results_ft <- final_results_ft %>% add_column(model = rep(1, 380))
final_results_ppa <- final_results_ppa %>% add_column(model = rep(0, 380))
final_results <- rbind(final_results_ft, final_results_ppa)
View(final_results)
final_results %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(title = "PAR", x = "FT height", y = "Absorbed PAR", colour = "Flat top")
final_results_ft %>% add_column(model = ft)
final_results_ft <- final_results_ft %>% add_column(model = rep(0, nrow(final_results_ft)))
final_results_ppa <- final_results_ppa %>% add_column(model = rep(0, nrow(final_results_ppa)))
final_results_ft <- organising_results(combined_results_ft)
final_results_ppa <- organising_results(combined_results_ppa)
final_results_ft <- final_results_ft %>% add_column(model = rep(0, nrow(final_results_ft)))
final_results_ppa <- final_results_ppa %>% add_column(model = rep(0, nrow(final_results_ppa)))
final_results_ft <- organising_results(combined_results_ft)
final_results_ppa <- organising_results(combined_results_ppa)
final_results_ft <- final_results_ft %>% add_column(model = "FT")
final_results_ft
final_results_ft <- final_results_ft %>% add_column(model = "FT")
final_results_ft <- organising_results(combined_results_ft)
final_results_ppa <- organising_results(combined_results_ppa)
final_results_ft <- final_results_ft %>% add_column(model = "FT")
final_results_ppa <- final_results_ppa %>% add_column(model = "PPA")
final_results %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(title = "PAR", x = "FT height", y = "Absorbed PAR", colour = "model")
final_results <- rbind(final_results_ft, final_results_ppa)
final_results %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(title = "PAR", x = "FT height", y = "Absorbed PAR", colour = "model")
final_results %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(x = "Focal tree height", y = "Absorbed PAR", colour = "Model")
library(Maeswrap)
library(tidyverse)
library(ggplot2)
read.csv("A")
read.csv("A.csv")
maespa <- read.csv("A.csv")
View(maespa)
final_results
maespa %>%
select(H, V, L, F, name, absPAR)
maespa
maespa <- maespa %>%
select(H, V, L, F, name, absPAR)
maespa
maespa <- maespa %>%
select(H, V, L, F, name, absPAR) %>%
add_column(model = "MAESPA")
maespa
maespa <- maespa %>%
select(H, V, L, F, name, absPAR) %>%
add_column(model = "MAESPA") %>%
rename(absPAR_m = absPAR)
maespa
maespa <- maespa %>%
select(H, V, L, F, name, absPAR) %>%
add_column(model = "MAESPA") %>%
rename(absPAR_m = absPAR)
maespa <- maespa %>%
select(H, V, L, F, name, absPAR) %>%
add_column(model = "MAESPA")
maespa <- read.csv("A.csv")
maespa <- maespa %>%
select(H, V, L, F, name, absPAR) %>%
add_column(model = "MAESPA") %>%
rename(absPAR_m = absPAR)
maespa
final_results_ft
maespa
maespa$absPAR_m/final_results_ft$absPAR
maespa <- read.csv("A.csv")
maespa <- maespa %>%
select(H, V, L, F, name, absPAR) %>%
add_column(model = "MAESPA")
maespa
final_results_m  <- rbind(maespa, final_results)
final_results_m
final_results_m %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(x = "Focal tree height", y = "Absorbed PAR", colour = "Model")
library(Maeswrap)
library(tidyverse)
library(ggplot2)
final_results %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(x = "Focal tree height", y = "Absorbed PAR", colour = "Model")
maespa %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(x = "Focal tree height", y = "Absorbed PAR", colour = "Model")
final_results %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(x = "Focal tree height", y = "Absorbed PAR", colour = "Model")
maespa %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(x = "Focal tree height", y = "Absorbed PAR", colour = "Model")
final_results %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(x = "Focal tree height", y = "Absorbed PAR", colour = "Model")
library(Maeswrap)
library(tidyverse)
library(ggplot2)
final_results_ft <- organising_results(combined_results_ft) %>% add_column(model = "FT")
final_results <- rbind(final_results_ft, final_results_ppa)
View(final_results)
final_results
library(Maeswrap)
library(tidyverse)
library(ggplot2)
final_results %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(x = "Focal tree height", y = "Absorbed PAR", colour = "Model")
final_results_ft$absPAR - maespa$absPAR
maespa$absPAR/final_results_ft$absPAR
mean(maespa$absPAR/final_results_ft$absPAR)
df <- final_results_ft %>%
mutate(
absPAR = absPAR*0.3263815
)
df
df %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(x = "Focal tree height", y = "Absorbed PAR", colour = "Model")
d <- rbind(df, maespa)
d %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(x = "Focal tree height", y = "Absorbed PAR", colour = "Model")
final_results_ft %>%
select(F, absPAR, H, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(H))) +
geom_line(aes(colour = as.factor(H))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(title = "PAR", x = "FT height", y = "Absorbed PAR", colour = "Flat top")
mean(final_results_ft$absPAR/maespa$absPAR)
df <- final_results_ft %>%
mutate(
absPAR = absPAR*3.786782
)
d %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(x = "Focal tree height", y = "Absorbed PAR", colour = "Model")
df <- final_results_ft %>%
mutate(
absPAR = absPAR*3.786782
)
d <- rbind(df, maespa)
d %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(x = "Focal tree height", y = "Absorbed PAR", colour = "Model")
df <- maespa %>%
mutate(
absPAR = absPAR*3.786782
)
d <- rbind(df, maespa)
d %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(x = "Focal tree height", y = "Absorbed PAR", colour = "Model")
d
View(d)
df <- maespa %>%
mutate(
absPAR = absPAR*3.786782
)
d <- rbind(df, final_results_ft)
d %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(x = "Focal tree height", y = "Absorbed PAR", colour = "Model")
final_results %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(x = "Focal tree height", y = "Absorbed PAR", colour = "Model")
View(results)
View(results[["H15_V0_L0.466_F1.99_S1"]])
results[[1]]
results[[100]]
results[[1000]]
source('~/Documents/Honours/models/Function_M.R', echo=TRUE)
results[[1000]] %>%
mutate(
t_h = htcrown + httrunk
)
x <- seq(0, 50, by=100)
E <- 0*h
h <- seq(0, 50, by=100)
E <- 0*h
z <- seq(0, x, by = n_slices)
htcrown
htcrown <- 6.36
# adpaytioan from Mawrap, https://github.com/RemkoDuursma/Maeswrap/blob/master/R/coord3dshape.R
n_slices <- 50
z <- seq(0, htcrown, by = n_slices)
distfun <- sqrt(1 - ((z-1/2)^2)/((1/2)^2))
z
# adpaytioan from Mawrap, https://github.com/RemkoDuursma/Maeswrap/blob/master/R/coord3dshape.R
n_slices <- 50
z <- seq(0, htcrown, by = n_slices)
z
htcrown
n_slices
seq(0, 6, by=50)
?seq
z <- seq(0, htcrown, length.out = n_slices)
z
distfun <- sqrt(1 - ((z-1/2)^2)/((1/2)^2))
distfun
z <- seq(0, 1, length.out = n_slices)
distfun <- sqrt(1 - ((z-1/2)^2)/((1/2)^2))
rx <- radx*distfun
ry <- rady*distfun
slice_xs_area < 3.14*rx*ry
radx <- rady <- 2.54
htcrown <- 6.36
larea <- 47.62
zabs <- z*htcrown
zabs
slice_xs_vol <- (htcrown/n_slices)*slice_xs_area
slice_volume_frac <- slice_xs_vol/sum(slice_xs_vol)
rx <- radx*distfun
ry <- rady*distfun
slice_xs_area < 3.14*rx*ry
slice_xs_vol <- (htcrown/n_slices)*slice_xs_area
slice_volume_frac <- slice_xs_vol/sum(slice_xs_vol)
slice_xs_area <- 3.14*rx*ry
slice_xs_vol <- (htcrown/n_slices)*slice_xs_area
slice_volume_frac <- slice_xs_vol/sum(slice_xs_vol)
plot(z, slice_volume_frac)
sum(slice_volume_frac)
tibble(
z = zabs,
h = httrunk + z,
leaf = larea*slice_volume_frac
)
httrunk <- 3
tibble(
z = zabs,
h = httrunk + z,
leaf = larea*slice_volume_frac
)
tibble(
z = zabs,
h = httrunk + z,
larea = larea*slice_volume_frac
) %>% pull(larea) %>% sum()
