L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai_ppa)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(tree = (sum(MJ*delta_t)*la))
}
results_PAR_ppa <- results_f %>%
purrr::map(PAR_calculator_ppa)
View(combinations)
data = results_f[["H15_V0.1_L4.402_F1.85_S2"]]
la = 47.62
met <- readmet(filename = "met.dat", nlines = -1)
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai_ppa)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(tree = (sum(MJ*delta_t)*la))
View(PAR_calculator)
View(PAR_calculator)
data = results_f[["H15_V0.1_L4.402_F1.99_S2"]]
la = 47.62
met <- readmet(filename = "met.dat", nlines = -1)
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai_ppa)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(tree = (sum(MJ*delta_t)*la))
View(PAR_calculator)
data = results_f[["H15_V0.1_L0.466_F1.99_S2"]]
la = 47.62
met <- readmet(filename = "met.dat", nlines = -1)
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai_ppa)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(tree = (sum(MJ*delta_t)*la))
View(PAR_calculator)
data = results_f[["H15_V0.1_L5.485_F1.99_S2"]]
la = 47.62
met <- readmet(filename = "met.dat", nlines = -1)
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai_ppa)
data = results_f[["H15_V0.1_L5.485_F0.5_S2"]]
la = 47.62
met <- readmet(filename = "met.dat", nlines = -1)
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai_ppa)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(tree = (sum(MJ*delta_t)*la))
View(PAR_calculator)
L_ft
data = results_f[["H15_V0.1_L5.485_F1_S2"]]
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai_ppa)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(tree = (sum(MJ*delta_t)*la))
L_ft
View(results_PAR_paa)
View(combined_results_ppa)
View(final_results_ppa)
PAR_calculator_ppa <- function(data,indi_la = 47.62) {
met <- readmet(filename = "met.dat", nlines = -1)
la = indi_la
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai_ppa)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(tree = (sum(MJ*delta_t)*la))
}
results_PAR_ppa <- results_f %>%
purrr::map(PAR_calculator_ppa)
View(results_PAR_ppa)
View(results_PAR_ppa[["H15_V0_L0.466_F1.99_S1"]])
View(results_PAR_ppa[["H15_V0_L4.402_F0.15_S2"]])
View(results_PAR_ppa[["H15_V0.5_L2.916_F1.05_S1"]])
final_results_ft %>%
select(F, tree, H, V, L) %>%
ggplot(aes(F, tree)) +
geom_point(aes(colour = as.factor(H))) +
geom_line(aes(colour = as.factor(H))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(title = "PAR", x = "FT height", y = "Absorbed PAR", colour = "Flat top")
final_results_ppa %>%
select(F, tree, H, V, L) %>%
ggplot(aes(F, tree)) +
geom_point(aes(colour = as.factor(H))) +
geom_line(aes(colour = as.factor(H))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(title = "PAR", x = "FT height", y = "Absorbed PAR", colour = "Flat top")
View(results_f[["H15_V0_L0.466_F1.99_S1"]])
View(results_f[["H15_V0_L0.466_F1.99_S2"]])
View(results_f[["H15_V0.25_L0.466_F0.4_S1"]])
View(results_f[["H15_V0.5_L0.466_F0.4_S2"]])
View(results_f[["H15_V0.5_L0.466_F0.01_S3"]])
View(combinations)
PAR_calculator_ppa(results_f[["H15_V0_L0.466_F1.99_S1"]])
PAR_calculator_ppa(results_f[["H15_V0_L0.466_F1.99_S1"]])
df <- PAR_calculator_ppa(results_f[["H15_V0_L0.466_F1.99_S1"]])
df
df <- PAR_calculator_ppa(results_f[["H15_V0_L0.466_F1_S1"]])
df
results_PAR_ppa
View(results_PAR_ppa)
View(results_PAR_ppa[["H15_V0_L0.466_F1.99_S1"]])
View(results_PAR_ppa[["H15_V0_L0.466_F0.65_S2"]])
View(results_PAR_ppa[["H15_V0.5_L0.466_F0.65_S2"]])
PAR_calculator_ft <- function(data,indi_la = 47.62) {
met <- readmet(filename = "met.dat", nlines = -1)
la = indi_la
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(tree = (sum(MJ*delta_t)*la))
}
PAR_calculator_ppa <- function(data,indi_la = 47.62) {
met <- readmet(filename = "met.dat", nlines = -1)
la = indi_la
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai_ppa)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(tree = (sum(MJ*delta_t)*la))
}
results_PAR_ft <- results_f %>%
purrr::map(PAR_calculator_ft)
results_PAR_ppa <- results_f %>%
purrr::map(PAR_calculator_ppa)
combining_results_ft <- function(sim_name) {
df <- combinations %>%
filter(name == sim_name) %>%
bind_cols(results_PAR_ft[[sim_name]])
}
combining_results_ppa <- function(sim_name) {
df <- combinations %>%
filter(name == sim_name) %>%
bind_cols(results_PAR_ppa[[sim_name]])
}
combined_results_ft <- combinations$name[1:nrow(combinations)] %>%
purrr::map(combining_results_ft)
names(combined_results_ft) <- combinations$name[1:nrow(combinations)] %>%
basename()
combined_results_ppa <- combinations$name[1:nrow(combinations)] %>%
purrr::map(combining_results_ppa)
names(combined_results_ppa) <- combinations$name[1:nrow(combinations)] %>%
basename()
organising_results <- function(data) {
df <- as.data.frame(matrix(unlist(data), nrow=length(unlist(data[1]))))
row.names(df) <- c("H", "V", "L", "F", "S", "path", "name", "tree")
df <- t(df)
row.names(df) <- 1:nrow(combinations)
df <- df %>% as_tibble() %>%
select(H, V, L, F, S, path, tree) %>%
mutate(
name = path %>% basename() %>% gsub("_S[1-3]", "",., perl = TRUE)
)
df <-  df %>%
transform(tree = as.numeric(tree), F = as.numeric(F),
H = as.numeric(H), V = as.numeric(V),
L = as.numeric(L), S = as.numeric(S))
df <- df %>%
group_by(H, V, L, F, name) %>%
summarise_at(vars(tree), mean)
}
final_results_ft <- organising_results(combined_results_ft)
final_results_ppa <- organising_results(combined_results_ppa)
names <- as_labeller(
c(`0` = "V 0", `0.1` = "V 0.1", `0.25` = "V 0.25", `0.5` = "V 0.5", `0.75` = "V 0.75",
`0.466` = "LAI 0.467", `1.488`= "LAI 1.349", `2.916`= "LAI 2.917", `4.402`= "LAI 4.485", `5.485`= "LAI 5.395")
)
final_results_ft %>%
select(F, tree, H, V, L) %>%
ggplot(aes(F, tree)) +
geom_point(aes(colour = as.factor(H))) +
geom_line(aes(colour = as.factor(H))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(title = "PAR", x = "FT height", y = "Absorbed PAR", colour = "Flat top")
final_results_ppa %>%
select(F, tree, H, V, L) %>%
ggplot(aes(F, tree)) +
geom_point(aes(colour = as.factor(H))) +
geom_line(aes(colour = as.factor(H))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(title = "PAR", x = "FT height", y = "Absorbed PAR", colour = "Flat top")
final_results_ft
PAR_calculator_ft <- function(data,indi_la = 47.62) {
met <- readmet(filename = "met.dat", nlines = -1)
la = indi_la
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(absPAR_ft = (sum(MJ*delta_t)*la))
}
PAR_calculator_ppa <- function(data,indi_la = 47.62) {
met <- readmet(filename = "met.dat", nlines = -1)
la = indi_la
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai_ppa)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(absPAR_ppa = (sum(MJ*delta_t)*la))
}
PAR_calculator_ppa <- function(data,indi_la = 47.62) {
met <- readmet(filename = "met.dat", nlines = -1)
la = indi_la
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai_ppa)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(absPAR_ppa = (sum(MJ*delta_t)*la))
}
PAR_calculator_ft <- function(data,indi_la = 47.62) {
met <- readmet(filename = "met.dat", nlines = -1)
la = indi_la
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(absPAR = (sum(MJ*delta_t)*la))
}
PAR_calculator_ppa <- function(data,indi_la = 47.62) {
met <- readmet(filename = "met.dat", nlines = -1)
la = indi_la
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai_ppa)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(absPAR = (sum(MJ*delta_t)*la))
}
PAR_calculator_ft <- function(data,indi_la = 47.62) {
met <- readmet(filename = "met.dat", nlines = -1)
la = indi_la
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(absPAR = (sum(MJ*delta_t)*la))
}
PAR_calculator_ppa <- function(data,indi_la = 47.62) {
met <- readmet(filename = "met.dat", nlines = -1)
la = indi_la
L_ft = data %>%
filter(focal == "TRUE") %>%
pull(lai_ppa)
PAR_calculator <-
tibble(
PAR_inst = met$PAR,
time = met$TIME) %>%
mutate(
delta_t = c(diff(time[1:2]), diff(time)),
absPAR_inst = PAR_inst*exp(-0.5*L_ft),#mu PAR m-2 s-1
W = absPAR_inst/2.02, #W PAR m-2 eqn 38 from paper
MJ = W*0.0036 #MJ PAR m-2 h-1 eqn 12 from paper
) %>%
summarise(absPAR = (sum(MJ*delta_t)*la))
}
results_PAR_ft <- results_f %>%
purrr::map(PAR_calculator_ft)
results_PAR_ppa <- results_f %>%
purrr::map(PAR_calculator_ppa)
combining_results_ft <- function(sim_name) {
df <- combinations %>%
filter(name == sim_name) %>%
bind_cols(results_PAR_ft[[sim_name]])
}
combining_results_ppa <- function(sim_name) {
df <- combinations %>%
filter(name == sim_name) %>%
bind_cols(results_PAR_ppa[[sim_name]])
}
combined_results_ft <- combinations$name[1:nrow(combinations)] %>%
purrr::map(combining_results_ft)
names(combined_results_ft) <- combinations$name[1:nrow(combinations)] %>%
basename()
combined_results_ppa <- combinations$name[1:nrow(combinations)] %>%
purrr::map(combining_results_ppa)
names(combined_results_ppa) <- combinations$name[1:nrow(combinations)] %>%
basename()
organising_results <- function(data) {
df <- as.data.frame(matrix(unlist(data), nrow=length(unlist(data[1]))))
row.names(df) <- c("H", "V", "L", "F", "S", "path", "name", "absPAR")
df <- t(df)
row.names(df) <- 1:nrow(combinations)
df <- df %>% as_tibble() %>%
select(H, V, L, F, S, path, absPAR) %>%
mutate(
name = path %>% basename() %>% gsub("_S[1-3]", "",., perl = TRUE)
)
df <-  df %>%
transform(absPAR = as.numeric(absPAR), F = as.numeric(F),
H = as.numeric(H), V = as.numeric(V),
L = as.numeric(L), S = as.numeric(S))
df <- df %>%
group_by(H, V, L, F, name) %>%
summarise_at(vars(absPAR), mean)
}
final_results_ft <- organising_results(combined_results_ft)
final_results_ppa <- organising_results(combined_results_ppa)
final_results_ft %>%
select(F, absPAR, H, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(H))) +
geom_line(aes(colour = as.factor(H))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(title = "PAR", x = "FT height", y = "Absorbed PAR", colour = "Flat top")
final_results_ppa %>%
select(F, absPAR, H, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(H))) +
geom_line(aes(colour = as.factor(H))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(title = "PAR", x = "FT height", y = "Absorbed PAR", colour = "Flat top")
ggplot(final_results_ft, aes(F, absPAR)) +
geom_point(final_results_ft, aes(colour = as.factor(H))) +
geom_line(final_results_ft, aes(colour = as.factor(H))) +
geom_point(final_results_ppa, aes(colour = as.factor(H))) +
geom_line(final_results_ppa, aes(colour = as.factor(H))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(title = "PAR", x = "FT height", y = "Absorbed PAR")
final_results_ft
final_results_ft %>% rename(absPAR_ft = absPAR)
final_results_ft %>% add_column(model = rep(1, 280))
final_results_ft %>% add_column(model = rep(1, 380))
final_results_ppa %>% add_column(model = rep(0, 380))
final_results_ft <- final_results_ft %>% add_column(model = rep(1, 380))
final_results_ppa <- final_results_ppa %>% add_column(model = rep(0, 380))
final_results <- rbind(final_results_ft, final_results_ppa)
View(final_results)
final_results %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(title = "PAR", x = "FT height", y = "Absorbed PAR", colour = "Flat top")
final_results_ft %>% add_column(model = ft)
final_results_ft <- final_results_ft %>% add_column(model = rep(0, nrow(final_results_ft)))
final_results_ppa <- final_results_ppa %>% add_column(model = rep(0, nrow(final_results_ppa)))
final_results_ft <- organising_results(combined_results_ft)
final_results_ppa <- organising_results(combined_results_ppa)
final_results_ft <- final_results_ft %>% add_column(model = rep(0, nrow(final_results_ft)))
final_results_ppa <- final_results_ppa %>% add_column(model = rep(0, nrow(final_results_ppa)))
final_results_ft <- organising_results(combined_results_ft)
final_results_ppa <- organising_results(combined_results_ppa)
final_results_ft <- final_results_ft %>% add_column(model = "FT")
final_results_ft
final_results_ft <- final_results_ft %>% add_column(model = "FT")
final_results_ft <- organising_results(combined_results_ft)
final_results_ppa <- organising_results(combined_results_ppa)
final_results_ft <- final_results_ft %>% add_column(model = "FT")
final_results_ppa <- final_results_ppa %>% add_column(model = "PPA")
final_results %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(title = "PAR", x = "FT height", y = "Absorbed PAR", colour = "model")
final_results <- rbind(final_results_ft, final_results_ppa)
final_results %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(title = "PAR", x = "FT height", y = "Absorbed PAR", colour = "model")
final_results %>%
select(F, absPAR, model, V, L) %>%
ggplot(aes(F, absPAR)) +
geom_point(aes(colour = as.factor(model))) +
geom_line(aes(colour = as.factor(model))) +
facet_grid(rows = vars(V), cols = vars(L), labeller = names) +
labs(x = "Focal tree height", y = "Absorbed PAR", colour = "Model")
